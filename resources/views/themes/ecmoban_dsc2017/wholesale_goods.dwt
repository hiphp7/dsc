<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="Keywords" content="{$keywords}" />
<meta name="Description" content="{$description}" />
<!-- TemplateBeginEditable name="doctitle" -->
<title>{$page_title}</title>
<!-- TemplateEndEditable -->
<!-- TemplateBeginEditable name="head" -->
<!-- TemplateEndEditable -->
<link rel="shortcut icon" href="favicon.ico" />
<!-- #BeginLibraryItem "/library/js_languages_new.lbi" --><!-- #EndLibraryItem -->
<link rel="stylesheet" type="text/css" href="__TPL__/css/wholesale_new.css" />
<link rel="stylesheet" type="text/css" href="__ROOT__js//perfect-scrollbar/perfect-scrollbar.min.css" />
</head>

<body>
<!-- #BeginLibraryItem "/library/page_header_business.lbi" --><!-- #EndLibraryItem -->
<div class="content b2b-content">
    <div class="w w1200">
        <!-- #BeginLibraryItem "/library/ur_here_wholesale.lbi" --><!-- #EndLibraryItem -->
    </div>
    <div class="container b2b-goods-container">
        <div class="w w1200">
            <div class="product-info">
                <!-- #BeginLibraryItem "/library/goods_gallery_wholesale.lbi" --><!-- #EndLibraryItem -->
                <div class="product-wrap product-wrap-min">
                    <form action="javascript:addToCart({$goods.goods_id})" method="post" name="ECS_FORMBUY" id="ECS_FORMBUY" >
                        <div class="name">{$goods.goods_name}</div>
                        <div class="summary">
                            <div class="summary-price-wrap">
                                <div class="s-p-w-wrap">
                                    <div class="summary-item">
                                    	<div class="si-tit">{$lang.trade_price}</div>
                                        <div class="si-warp">
                                            <div class="s-tr">
                                                {if $goods.price_model eq 1}
                                                {foreach from=$goods.volume_price item=price name=price}
                                                <div class="s-td{if $smarty.foreach.price.last} last{/if}">
                                                    <div class="qp-price"><em>¥</em>{$price.volume_price}</div>
                                                    <div class="m-price"><em>¥</em>{$goods.retail_price}</div>
                                                </div>
                                                {/foreach}
                                                {else}
                                                <div class="s-td">
                                                    <div class="qp-price"><em>¥</em>{$goods.goods_price}</div>
                                                    <div class="m-price"><em>¥</em>{$goods.retail_price}</div>
                                                </div>
                                                {/if}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="summary-item">
                                    	<div class="si-tit">{$lang.the_batch}</div>
                                        <div class="si-warp">
											{if $goods.price_model eq 1}
                                            <div class="s-tr">
                                                {foreach from=$goods.volume_price item=number name=number key=key}
                                                    {if !$smarty.foreach.number.last}
                                                    <div class="s-td"><span class="ftx-06">{$number.volume_number}-{$number.range_number}{$goods.goods_unit}</span></div>
                                                    {else}
                                                    <div class="s-td"><span class="ftx-06">≥{$number.volume_number}{$goods.goods_unit}</span></div>
                                                    {/if}
                                                {/foreach}
                                            </div> 
										    {else}
                                            <div class="s-tr">
												<div class="s-td"><span class="ftx-06">≥{$goods.moq}{$goods.goods_unit}</span></div>
                                            </div>											
											{/if}
                                        </div>
                                    </div>    
                                    <div class="clear"></div>
                                </div>
                            </div>
                            <div class="summary-basic-info">
                                <!-- {foreach from=$specification item=spec key=spec_key name=foo} -->
                                <!-- {if $smarty.foreach.foo.last} -->
                                <div class="summary-item is-size">
                                    <div class="si-tit">{$spec.name}</div>
                                    <div class="si-warp">
                                        <div class="si-lie-list" ectype="main_attr_list">
                                            {include file='library/wholesale_main_attr_list.lbi'}
                                        </div>
                                    </div>
                                    <ul class="hide" ectype="select_record"></ul>
                                    <div class="whodet" ectype="whodet">
                                        <div class="whodet-list">
                                            <div class="w-number"><em class="org" ectype="w-number">0</em>{$lang.individual}</div>
                                            <div class="w-total">{$lang.general}<em class="org" ectype="w-total">0.00</em>{$lang.element}</div>
                                            <div class="w-handle" ectype="w-handle">{$lang.selected_list}<i></i></div>
                                        </div>
                                        <div class="whodet-goods-info">
                                        	<div class="wginfo" ectype="wginfo">
												{include file='library/wholesale_select_record_data.lbi'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clear"></div>
                                <!-- {else} -->
                                <!-- {if $spec.values} -->
                                <div class="summary-item is-attr goods_info_attr" ectype="is-attr" data-type="radio">
                                    <div class="si-tit">{$spec.name}</div>
                                    <!-- {if $cfg.goodsattr_style eq 1} -->
                                    <div class="si-warp">
                                        <ul>
                                            <!-- {foreach from=$spec.values item=value key=key name=attrvalues} -->  
                                            {if $spec.is_checked > 0}
                                            <li class="item{if $value.checked eq 1} selected{/if}" data-name="{$value.id}">
                                                <b></b>
                                                <a href="{if $value.img_site}{$value.img_site}{else}javascript:void(0);{/if}">
                                                    {if $value.img_flie}
                                                    <img src="{$value.img_flie}" width="24" height="24" />
                                                    {/if}
                                                    <i>{$value.label}</i>
                                                    <input id="spec_value_{$value.id}" type="radio" data-attrtype="1" name="spec_{$spec_key}" value="{$value.id}" class="hide" {if $value.checked eq 1} checked{/if} />
                                                </a>
                                            </li>
                                            {else}
                                            <li class="item {if $key eq 0} selected{/if}" data-name="{$value.id}">
                                                <b></b>
                                                <a href="javascript:void(0);" name="{$value.id}" class="noimg">
                                                    <i>{$value.label}</i>
                                                    <input id="spec_value_{$value.id}" type="radio" data-attrtype="1" name="spec_{$spec_key}" value="{$value.id}" class="hide" {if $key eq 0}checked{/if} /></a>
                                                </a>
                                            </li>						
                                            {/if}
                                            <!-- {/foreach} -->
                                        </ul>
                                    </div>
                                    <!-- {else} 列表下拉-->
                                    ...
                                    <!-- {/if} -->
                                    <input type="hidden" name="spec_list" value="{$spec_key}" data-spectype="{if $spec.attr_type eq 1}attr-radio{else}attr-check{/if}" />
                                </div>
                                <!-- {/if} -->
                                <!-- {/if} -->
                                <!-- {foreachelse} -->
								<div class="summary-item is-size">
                                    <div class="si-tit">{$lang.specification}</div>
                                    <div class="si-warp">
                                        <div class="si-lie-list">
											<div class="lie">
												<div class="row1"><strong class="ftx-06">{if $goods.goods_type > 0 && $specification}{$lang.unknown_specifications}<em class="red">({$lang.do_not_buy})</em>{else}{$lang.not_specification}{/if}</strong></div>
												<div class="row2"><div class="price">{$goods.goods_price_formatted}</div></div>
												<div class="row3">
													<div class="b-stock">{$lang.inventory}{$goods.goods_number|default:0}</div>
												</div>
												<div class="row4">
                                                	<div class="number">
														<a href="javascript:void(0)" class="decrement btn-reduce">-</a>
														<input name="goods_number" type="text" id="quantity" class="itxt buy-num" value="0" size="10" data-inventory="{$goods.goods_number}">
														<a href="javascript:void(0)" class="increment btn-add">+</a>
													</div>
                                                </div>
											</div>
                                        </div>
                                    </div>
                                    <div class="whodet" ectype="whodet">
                                        <div class="whodet-list">
                                            <div class="w-number"><em class="org" ectype="w-number">0</em>{$lang.individual}</div>
                                            <div class="w-total">{$lang.general}<em class="org" ectype="w-total">0.00</em>{$lang.element}</div>
                                        </div>
                                    </div>									
								</div>
                                <!-- {/foreach} -->								
                            </div>
                            {if $wholesale_rank}
                            <div class="summary-item is-ladder">
                                <div class="si-tit">{$lang.wholesale_rank}</div>
                                <div class="si-warp">
                                    <a href="javascript:void(0);" class="link-red" ectype="view_priceLadder">{$lang.View_price_ladder}</a>
                                    <dl class="priceLadder" ectype="priceLadder">
                                        <dt>
                                        <span>{$lang.rank}</span>
                                        </dt>
                                        <!-- {foreach from=$wholesale_rank item=rank key=price_key} -->
                                        <dd>
                                            <span>{$rank.rank_name}</span>
                                        </dd>
                                        <!-- {/foreach} -->
                                    </dl>
                                    &nbsp;&nbsp;&nbsp;{$lang.rank_desc}
                                </div>
                            </div>
                            {/if}
                            {if $goods.review_status eq 3 && $goods.suppliers_review_status eq 3 && $goods.enabled eq 1 }
                            <div class="choose-btns clearfix">
								<a href="javascript:void(0);" onClick="addToWholesaleCart({$goods.goods_id}, 0);" class="btn-b2b-buynow">{$lang.order_immediately}</a>
								<a href="javascript:void(0);" onClick="addToWholesaleCart({$goods.goods_id}, 1);" class="btn-b2b-append"><i class="iconfont icon-b2b-cart"></i>{$lang.add_purchase_list}</a>
                            </div>
                            {else}
                            <div class="choose-btns clearfix">
								<a href="javascript:void(0);" class="btn-invalid"><i class="iconfont"></i>{$lang.goods_is_sold_out}</a>
                            </div>                            
                            {/if}
                            <div class="summary-item summary-tips">
								{if $goods.goods_extend.is_delivery || $goods.goods_extend.is_free || $goods.goods_extend.is_return}
                                <div class="si-tit">{$lang.power_security}</div>
                                <div class="si-warp">
                                    <ul class="tips-list">
                                    {if $goods.goods_extend.is_delivery}<li><em class="goods-icons">48</em>48{$lang.shippment}</li>{/if}
                                    {if $goods.goods_extend.is_free}<li><em class="goods-icons">{$lang.mail}</em>{$lang.pinkage}</li>{/if}
                                    {if $goods.goods_extend.is_return}<li><em class="goods-icons">{$lang.refund}</em>{$lang.can_back}</li>{/if}
                                    </ul>
                                </div>
								{/if}
                            </div>
                            <div class="summary-item summary-tips">
                            <!--{if $two_code}-->
                            <div class="si-phone-code">
                                <div class="qrcode-wrap">
                                    <div class="qrcode_tit si-tit" style="width:80px;">{$lang.summary_phone}<i class="iconfont icon-qr-code"></i></div>
                                    <div class="qrcode_pop" style="top: 40px; left: 0; position: absolute;">
                                        <div class="mobile-qrcode"><img src="{$weixin_img_url}" alt="{$lang.two_code}" title="{$weixin_img_text}" width="175"></div>
                                    </div>
                                </div>
                            </div>
                            <!--{/if}-->
                            </div>
                            <input type="hidden" value="{$act_id}" id="act_id" name="act_id">
                            <input type="hidden" value="{$user_id}" id="user_id" name="user_id">
                            <input type="hidden" value="{$goods_id}" id="goods_id" name="goods_id">
                            <input type="hidden" value="{$goods_id}" id="good_id" name="good_id">
                            <input type="hidden" value="{$goods.goods_type}" id="goods_type" name="goods_type">
                            <input type="hidden" value="{$has_specification}" id="has_specification" name="has_specification">
                            <input type="hidden" value="{$goods.moq}" id="moq" name="moq">
                            <input type="hidden" value="{$region_id}" id="region_id" name="region_id">
                            <input type="hidden" value="{$area_id}" id="area_id" name="area_id">
                        </div>
                    </form>
                </div>
                <div class="seller-pop">
					{if $goods.suppliers_logo}
                    <div class="seller-logo">
                        <a href="{$goods.suppliers_url}" ><img src="{$goods.suppliers_logo}" /></a>
                    </div>
					{/if}
                    <div class="seller-info tc ">
                        <a href="{$goods.suppliers_url}" title="{$goods.suppliers_name}" class="name">{$goods.suppliers_name}</a>
                    </div>
                    <div class="seller-item">
                        <p>{$lang.contact_seller}：{$goods.mobile_phone}</p>
                        <p>{$lang.place_region}：{$goods.company_address}</p>
                    </div>
                    <!--{if $goods.kf_qq_all}-->
                    <div class="seller-item">
                        <div class="service_list">
                            <ul style="padding:0;">
                            {foreach from=$goods.kf_qq_all  item=kf_qq}
                                <li class="service_qq"><a href="http://wpa.qq.com/msgrd?v=3&uin={$kf_qq.1}&site=qq&menu=yes" target="_blank"><i class="icon i-kefu"></i><span>{$kf_qq.0}</span></a></li>
                            {/foreach}
                            </ul>
                        </div>
                    </div>
                    <!--{/if}-->

                </div>               
                <div class="clear"></div>
					
                <div class="goods-main-layout who-goods-main-layout">
                    <div class="g-m-left">	
                    	<div class="g-main g-store-info" ectype="gm-tabs">
                            <div class="mt">
                                <h3>{$goods.suppliers_name}</h3>
                            </div>
                            <div class="mc">
                                <div class="mc-warp">
                                    <div class="g-s-brand">
                                    {if $goods.suppliers_logo}
                                        <a href="{$goods.suppliers_url}" ><img src="{$goods.suppliers_logo}" /></a>
                                    {/if}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--{if $goods.kf_qq_all}-->
                            <div class="g-main service_list">
                                <div class="mt"><h3>{$lang.store_customer_service}</h3></div>
                                <div class="mc">
                                    <ul>
                                        {foreach from=$goods.kf_qq_all  item=kf_qq}
                                            <li class="service_qq"><a href="http://wpa.qq.com/msgrd?v=3&uin={$kf_qq.1}&site=qq&menu=yes" target="_blank"><i class="icon i-kefu"></i><span>{$kf_qq.0}</span></a></li>
                                        {/foreach}
                                    </ul>
                                </div>
                            </div>
                        <!--{/if}-->
                        <div class="g-main g-history">
                            <div class="mt">
                                <h3>{$lang.buyers_still_looking}</h3>
                            </div>
                            <div class="mc">
                                <div class="mc-warp" id="history_list">
                                    <ul>
                                        <!--{foreach from=$see_more_goods item=goods}-->
                                        <li>
                                            <div class="p-img"><a href="{$goods.goods_url}" target="_blank" title="{$goods.goods_name|escape:html}"><img src="{$goods.goods_thumb}" width="170" height="170"></a></div>
                                            <div class="p-name"><a href="{$goods.goods_url}" target="_blank" title="{$goods.goods_name|escape:html}">{$goods.goods_name}</a></div>
                                            <div class="p-lie">
                                                <div class="p-price">
                                                    {$goods.price}
                                                </div>
                                            </div>
                                        </li>
                                        <!--{foreachelse}-->
                                        <li class="no_notic">{$lang.goods_not_been_set}</li>
                                        <!-- {/foreach} -->
                                    </ul>
                                </div>
                            </div>
                        </div>	
                    </div>
                    <div class="g-m-detail">
                        <div class="gm-tabbox" ectype="gm-tabs">
                            <ul class="gm-tab">
                                <li class="curr" ectype="gm-tab-item">{$lang.goods_details}</li>
                                <!-- {if $properties} --><li ectype="gm-tab-item">{$lang.specification_parameter}</li><!--{/if}-->
                            </ul>
                            <div class="extra">
                                <div class="item">
                                    <!--{if $two_code}-->
                                    <div class="si-phone-code">
                                        <div class="qrcode-wrap">
                                            <div class="qrcode_tit">{$lang.summary_phone}<i class="iconfont icon-qr-code"></i></div>
                                            <div class="qrcode_pop">
                                                <div class="mobile-qrcode"><img src="{$weixin_img_url}" alt="{$lang.two_code}" title="{$weixin_img_text}" width="175"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <!--{/if}-->
                                    <div class="inner">
                                        <a href="javascript:void(0)" class="btn sc-redBg-btn" id="btn-anchor" ectype="tb-tab-anchor">{$lang.btn_add_to_cart}</a>
                                        <div class="tb-popsku">
                                            <span class="arrow-top"></span>
                                            <div class="tb-popsku-content">
                                                <div class="tb-list">
                                                    <div class="tb-label">{$lang.price}：</div>
                                                    <div class="tb-value"><strong class="shop-price" ectype="SHOP_PRICE"></strong></div>
                                                </div>
                                                <!-- {foreach from=$specification item=spec key=spec_key} -->
                                                <!-- {if $spec.values} -->
                                                <div class="tb-list is-attr goods_info_attr" ectype="is-attr" data-type="<!-- {if $spec.attr_type eq 1} -->radio<!-- {else} -->checkbox<!-- {/if} -->">
                                                    <div class="tb-label">{$spec.name}:</div>
                                                    <!-- {if $cfg.goodsattr_style eq 1} -->
                                                    <div class="tb-value">
                                                        <ul>
                                                            <!-- {foreach from=$spec.values item=value key=key name=attrvalues} -->  
                                                            {if $spec.is_checked > 0}
                                                            <li class="item{if $value.checked eq 1} selected{/if}" data-name="{$value.id}">
                                                                <b></b>
                                                                <a href="{if $value.img_site}{$value.img_site}{else}javascript:void(0);{/if}"{if $value.img_site} target="_blank"{/if}>
                                                                    {if $value.img_flie}
                                                                    <img src="{$value.img_flie}" width="24" height="24" />
                                                                    {/if}
                                                                    <i>{$value.label}</i>
                                                                    <input id="spec_value_{$value.id}" type="{if $spec.attr_type eq 2}checkbox{else}radio{/if}" data-attrtype="{if $spec.attr_type eq 2}2{else}1{/if}" name="spec_{$spec_key}" value="{$value.id}" class="hide" {if $value.checked eq 1}checked{/if} />
                                                                </a>
                                                            </li>
                                                            {else}
                                                            <li class="item{if $key eq 0} selected{/if}" data-name="{$value.id}">
                                                                <b></b>
                                                                <a href="javascript:void(0);" name="{$value.id}" class="noimg">
                                                                    <i>{$value.label}</i>
                                                                    <input id="spec_value_{$value.id}" type="{if $spec.attr_type eq 2}checkbox{else}radio{/if}" data-attrtype="{if $spec.attr_type eq 2}2{else}1{/if}" name="spec_{$spec_key}" value="{$value.id}" class="hide" {if $key eq 0}checked{/if} /></a> 											
                                                                </a>
                                                            </li>									
                                                            {/if}
                                                            <!-- {/foreach} -->
                                                        </ul>
                                                    </div>
                                                    <!-- {else} 列表下拉-->
                                                    ...
                                                    <!-- {/if} -->
                                                    <input type="hidden" name="spec_list" value="{$spec_key}" data-spectype="{if $spec.attr_type eq 1}attr-radio{else}attr-check{/if}" />
                                                </div>
                                                <!-- {/if} -->
                                                <!-- {/foreach} -->
                                                <div class="tb-list">
                                                    <div class="tb-label">{$lang.number}：</div>
                                                    <div class="tb-value">
                                                        <div class="amount-warp">
                                                            <input class="text buy-num" ectype="quantity" onblur="changePrice()" value="1" name="number" defaultnumber="1">
                                                            <div class="a-btn">
                                                                <a href="javascript:void(0);" class="btn-add"><i class="iconfont icon-up"></i></a>
                                                                <a href="javascript:void(0);" class="btn-reduce btn-disabled"><i class="iconfont icon-down"></i></a>
                                                            </div>
                                                            <input name="confirm_type" id="confirm_type" type="hidden" value="3" />
                                                            <input type="hidden" ectype="perNumber" value="1000">
                                                            <input type="hidden" ectype="perMinNumber" value="1">																
                                                        </div>
                                                        <span class="lh30 ml10">{$lang.goods_inventory}&nbsp;<em ectype="goods_attr_num"></em>&nbsp;{if $goods.goods_unit}{$goods.goods_unit}{else}{$goods.measure_unit}{/if}</span>
                                                    </div>
                                                </div>
                                                <div class="tb-list">
                                                    <div class="tb-label">&nbsp;</div>
                                                    <div class="tb-value">
                                                        <a href="javascript:bool=0;addToCartShowDiv({$goods.goods_id})" class="cz-btn cz-btn-true" ectype="btn-append">{$lang.confirm}</a>
                                                        <a href="javascript:void(0);" class="cz-btn cz-btn-false" ectype="tb-cancel">{$lang.cancel}</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="gm-tab-qp-bort" ectype="qp-bort"></div>
                        </div>
                        <div class="gm-floors" ectype="gm-floors">
                            <div class="gm-f-item gm-f-details" ectype="gm-item">
                                <div class="gm-title">
                                    <h3>{$lang.goods_details}</h3>
                                </div>
                                <div class="goods-para-list">
                                    <dl class="goods-para">
                                        <dd class="column"><span>{$lang.goods_name}：{$goods.goods_name|escape:html}</span></dd>
                                        <dd class="column"><span>{$lang.Commodity_number}：{$goods.goods_sn}</span></dd>
                                        <dd class="column"><span>{$lang.seller_store}：<a href="{$goods.store_url}" title="{$goods.rz_shopName}" target="_blank">{$goods.rz_shopName}</a></span></dd>
                                        <!-- {if $cfg.show_goodsweight} 商品重量-->
                                        <dd class="column"><span>{$lang.weight}：{$goods.goods_weight}</span></dd>
                                        <!-- {/if} -->
                                        <!-- {if $cfg.show_addtime} 上架时间-->
                                        <!--<dd class="column"><span>{$lang.add_time}{$goods.add_time}</span></dd>-->
                                        <!-- {/if} -->
                                    </dl>

                                    <!-- {if $properties} -->
                                    <dl class="goods-para">
                                        <!-- {foreach from=$properties item=property_group key=key} -->
                                        <!-- {foreach from=$property_group item=property name=noproperty} -->
                                        <!-- {if $smarty.foreach.noproperty.iteration lt 13} -->
                                        <dd class="column"><span title="{$property.value}">{$property.name|escape:html}：{$property.value}</span></dd>
                                        <!-- {/if} -->
                                        <!-- {/foreach}-->
                                        <!-- {/foreach}-->
                                    </dl>
                                    <!-- {/if} -->
                                    <!-- {if $extend_info} -->
                                    <dl class="goods-para">
                                        <!-- {foreach from=$extend_info item=info key=key} -->	
                                        <dd class="column"><span title="{$info|escape:html}">{$key}：{$info|escape:html}</span></dd>
                                        <!-- {/foreach}-->
                                    </dl>
                                    <!-- {/if} -->
                                    <!-- {if $properties} -->
                                    <p class="more-par">
                                        <a href="#product-detail" class="ftx-05">{$lang.more_parameters}>></a>
                                    </p>
                                    <!--{/if}-->
                                </div>

                                {$goods.goods_desc}
                            </div>
                            <!-- {if $properties} -->
                            <div class="gm-f-item gm-f-parameter" ectype="gm-item" id="product-detail">
                                <div class="gm-title">
                                    <h3>{$lang.specification_parameter}</h3>
                                </div>
                                <div class="Ptable">
                                    <!-- {foreach from=$properties item=property_group key=key} -->
                                    <div class="Ptable-item">
                                        <h3>{$key}</h3>
                                        <dl>
                                            <!-- {foreach from=$property_group item=property} -->
                                            <dt>{$property.name|escape:html}</dt>
                                            <dd title="{$property.value}">{$property.value}</dd>
                                            <!-- {/foreach}-->
                                        </dl>
                                    </div>
                                    <!-- {/foreach}-->
                                </div>
                            </div>
                            <!-- {/if} -->
                        </div>
                    </div>	
                </div>
            </div>
        </div>
    </div>
</div>
<!-- #BeginLibraryItem "/library/page_footer.lbi" --><!-- #EndLibraryItem -->
{insert_scripts files='jquery.SuperSlide.2.1.1.js,common.js,warehouse.js,magiczoomplus.js,perfect-scrollbar/perfect-scrollbar.min.js'}
<script type="text/javascript" src="__TPL__/js/dsc-common.js"></script>
<script type="text/javascript" src="__TPL__/js/jquery.purebox.js"></script>

<script type="text/javascript">
var goods_id = {$goods_id};
var goodsattr_style = {$cfg.goodsattr_style|default:1};
var gmt_end_time = {$promote_end_time|default:0};
var goodsId = {$goods_id};
var now_time = {$now_time};

$(function(){
	//商品详情
	goods_desc_floor();
	
	$("*[ectype='w-handle']").on("click",function(){
		var parent = $(this).parents("*[ectype='whodet']");
		var wginfo = parent.find("*[ectype='wginfo']");
		var wginfo_parent = wginfo.parents(".whodet-goods-info");
		var top = wginfo_parent.height();
		if(parent.hasClass("whodet-cur")){
			parent.removeClass("whodet-cur");
			wginfo_parent.css({"top":0});
		}else{
			parent.addClass("whodet-cur");
			wginfo_parent.css({"top":-(top+2)});
		}
		
		wginfo.perfectScrollbar("destroy");
		wginfo.perfectScrollbar();
	});
	
	$(document).on('click', '.btn-add',function(){
		var num = $(this).siblings('.buy-num').val();
		num = parseInt(num);
		$(this).siblings('.buy-num').val(num+1);
		
		$("*[ectype='whodet']").show();
		set_select_record($(this));
	});
	
	$(document).on('click', '.btn-reduce',function(){
		var num = $(this).siblings('.buy-num').val();
		num = parseInt(num);
		if(num>0){
			$(this).siblings('.buy-num').val(num-1);
		}
		set_select_record($(this));
	});
		
	$(document).on('keyup', '.buy-num', function(){
		if($(this).val() < 0 || isNaN($(this).val()) || $(this).val() == ''){
			$(this).val(0);
		}
		$("*[ectype='whodet']").show();
		set_select_record($(this));
	});
	
	$(document).on('blur', '.buy-num', function(){
		var val = $(this).val();
		if(val.length>1){
			$(this).val(val.replace(/\b(0+)/gi,""));
		}
	});
	
	//默认加载价格
	changePrice();
	
	//商品相册小图滚动
	$(".spec-list").slide({mainCell:".spec-items ul",effect:"left",trigger:"click",pnLoop:false,autoPage:true,scroll:1,vis:5,prevCell:".spec-prev",nextCell:".spec-next"});
});



//切换属性计算价格
function changePrice()
{
	var goods_attr_id = getSelectedAttributes(document.forms['ECS_FORMBUY']);
	var attr_id = goods_attr = getSelectedAttributesGroup(document.forms['ECS_FORMBUY']);
	var goods_attr = '&goods_attr=' + attr_id;
	
	Ajax.call('wholesale_goods.php', 'act=price&id=' + goodsId + '&attr=' + goods_attr_id + goods_attr, changePriceResponse, 'GET', 'JSON');
}

/**
 * 接收返回的信息
 */
function changePriceResponse(res)
{
	if (res.err_msg.length > 0){
		pbDialog(res.err_msg,"",0);
	}else{
		//by wu
		$("[ectype='main_attr_list']").html(res.main_attr_list);
		
		$("*[ectype='main_attr_list']").perfectScrollbar("destroy");
		$("*[ectype='main_attr_list']").perfectScrollbar();
		
		get_select_record();
	}
}

//配送地区 常用地址选择
function get_region_change(goods_id, province_id, city_id, district_id){
	Ajax.call("ajax_dialog.php", 'id=' + goods_id + '&act=in_stock' + '&province=' + province_id + "&city=" + city_id + "&district=" + district_id, ajax_is_inStock, "GET", "JSON");
}

function ajax_is_inStock(res){
	var t = '&t=' + parseInt(Math.random()*1000);
	var str_new = window.location.href.replace(/\&t\=\d+/g,t);
	location.href = str_new;
}
/* 获取配送区域 end*/

/*****************************补充js by wu*****************************/
//设置添加记录
function set_select_record(obj){
	//转换对象
	if(!obj.hasClass('buy-num')){
		obj = obj.siblings('.buy-num');
	}
	var num = obj.val(); //数量
	var inventory = obj.data('inventory'); //库存
	
	//判断库存
	if(num > inventory){
		pbDialog('{$lang.purchase_goods_inventory_null}', '', 0);
		obj.val(inventory);
		num = inventory;
	}	

	//查看是否设置属性
	var goods_type = parseInt($("input[name='goods_type']").val());
    var has_specification = parseInt($("input[name='has_specification']").val());
	if(goods_type > 0 && has_specification > 0){
		var attr_group = obj.parents("[ectype='attr_group']").data('attr_group');
		if(num > 0){	
			if($("[ectype='select_record'] [data-attr='"+attr_group+"']").length == 0){
				var html = "<li data-attr='"+attr_group+"' data-num='"+num+"'></li>";
				$("[ectype='select_record']").append(html)
			}else{
				$("[ectype='select_record'] [data-attr='"+attr_group+"']").attr('data-num', num);
			}
		}else if (num == 0){
			$("[ectype='select_record'] [data-attr='"+attr_group+"']").remove();
		}
	}
	
	calculate_select_record();
}

//获取添加记录
function get_select_record(){
	$("[ectype='attr_group']").each(function(){
		var attr_group = $(this).data('attr_group');
		var select_num = $("[ectype='select_record']").find("[data-attr='"+attr_group+"']").attr('data-num');
		if(/\d+/.test(select_num)){
			$(this).find(".buy-num").val(select_num);
		}else{
            $(this).find(".buy-num").val(1);
            $("*[ectype='whodet']").show();
            set_select_record($(this).find(".buy-num"));
		}
	})
}	

//计算数量价格
function calculate_select_record(){
	var goods_id = $("input[name='goods_id']").val();
	//查看是否设置属性
	var goods_type = parseInt($("input[name='goods_type']").val());
    var has_specification = parseInt($("input[name='has_specification']").val());
	if(goods_type > 0 && has_specification > 0){	
		/*加载已选择商品 by wu start*/
		var attr_array = new Array();
		var num_array = new Array();
		$("[ectype='select_record'] li").each(function(i){
			var attr = $(this).attr('data-attr');
			var num = $(this).attr('data-num');
			attr_array.push(attr);
			num_array.push(num);
		})
		//异步处理
		$.ajax({
			url:'wholesale_goods.php?act=get_select_record',
			type:'post',
			data:{'goods_id':goods_id, 'attr_array':attr_array, 'num_array':num_array}, //传递数组数据
			dataType:'json',		
			success:function(data){
				$("[ectype='w-number']").html(data.total_number);
				$("[ectype='w-total']").html(data.data.total_price_formatted);
				$("[ectype='main_attr_list'] .price").html(data.data.unit_price_formatted);
				$("[ectype='wginfo']").html(data.record_data);
			}
		})
		/*加载已选择商品 by wu end*/	
	}else{
		var goods_number = $("input[name='goods_number']").val();
		$.jqueryAjax('wholesale_goods.php?act=get_select_record', 'goods_id='+goods_id+'&goods_number='+goods_number, function(data){
			$("[ectype='w-number']").html(data.total_number);
			$("[ectype='w-total']").html(data.data.total_price_formatted);			
			$(".si-lie-list .price").html(data.data.unit_price_formatted);			
		});
	}
}

/* *
 * 添加商品到购物车 
 */
function addToWholesaleCart(goodsId, type)
{
    var goods_id = goodsId;
	var moq = parseInt($("input[name='moq']").val());
	var goods_id = $("input[name='goods_id']").val();
	var user_id = $("input[name='user_id']").val();
	//判断是否登录
	if(user_id == 0){
		$.notLogin("get_ajax_content.php?act=get_login_dialog",'wholesale_goods.php?id='+goods_id);	
		return false;
	}	
        
	//查看是否设置属性
	var goods_type = parseInt($("input[name='goods_type']").val());
    var has_specification = parseInt($("input[name='has_specification']").val());
	if(goods_type > 0 && has_specification > 0){
		var goods_number = 0;
		/*加载已选择商品 by wu start*/
		var attr_array = new Array();
		var num_array = new Array();
		$("[ectype='select_record'] li").each(function(i){
			var attr = $(this).attr('data-attr');
			var num = $(this).attr('data-num');
			attr_array.push(attr);
			num_array.push(num);
			goods_number += parseInt(num); //商品总数
		})
		if(goods_number == 0){
			pbDialog('{$lang.please_select_purchase_goods}', '', 0);
		}else{
			//异步处理
			$.ajax({
				url:'wholesale_flow.php?step=add_to_cart',
				type:'post',
				data:{'goods_id':goods_id, 'attr_array':attr_array, 'num_array':num_array}, //传递数组数据
				dataType:'json',		
				success:function(data){
					if(data.error == 1){
						pbDialog(data.content, '', 0);
					}else if(data.error == 2){
						pbDialog(data.content, '', 0);
						$.notLogin("get_ajax_content.php?act=get_login_dialog",'wholesale_goods.php?id='+goods_id);	
					}else{
						if(type == 0){
							if(goods_number < moq){
								pbDialog('{$lang.purchase_goods_little_min}', '', 0);
							}else{
								location.href='wholesale_flow.php?step=cart&goods_id='+goods_id;
							}
						}else{
							var cartInfo = document.getElementById('ECS_WHOLESALE_CARTINFO');
							var cart_url = 'wholesale_flow.php?step=cart';
							if (cartInfo)
							{
								cartInfo.innerHTML = data.content;
								
								pb({
									divId:"b2b-cart-popup",
									title:"{$lang.hint}",
									width:455,
									height:50,
									content:"<div class='ts'>{$lang.goods_add_purchase}</div>",
									ok_title:"{$lang.go_pay}",
									cl_title:"{$lang.go_cart}",
									onOk:function(){
										window.location.href = "wholesale_flow.php?step=cart";
									}
								});
							}
						}
                    }
				}
			})	
		}
		/*加载已选择商品 by wu end*/	
	}else{
		var goods_number = parseInt($("input[name='goods_number']").val());
		if(goods_number == 0){
			pbDialog('{$lang.please_select_purchase_goods}', '', 0);
		}else{
			$.jqueryAjax('wholesale_flow.php?step=add_to_cart', 'goods_id='+goods_id+'&goods_number='+goods_number, function(data){
				if(data.error == 1){
					pbDialog(data.content, '', 0);
				}else if(data.error == 2){
					pbDialog(data.content, '', 0);
					$.notLogin("get_ajax_content.php?act=get_login_dialog",'wholesale_goods.php?id='+goods_id);	
				}else{
					if(type == 0){
						if(goods_number < moq){
							pbDialog('{$lang.purchase_goods_little_min}', '', 0);
						}else{
							location.href='wholesale_flow.php?step=cart&goods_id='+goods_id;
						}
					}else{
						var cartInfo = document.getElementById('ECS_WHOLESALE_CARTINFO');
						var cart_url = 'wholesale_flow.php?step=cart';
						if(cartInfo){
							cartInfo.innerHTML = data.content;
							pb({
								divId:"b2b-cart-popup",
								title:"{$lang.hint}",
								width:455,
								height:50,
								content:"<div class='ts'>{$lang.goods_add_purchase}</div>",
								ok_title:"{$lang.go_pay}",
								cl_title:"{$lang.go_cart}",
								onOk:function(){
									window.location.href = "wholesale_flow.php?step=cart";
								}
							});
						}				
					}	
            	}
			});
		}
	}
}
/******************************************* js方法 end***********************************************/	
</script>
</body>
</html>
